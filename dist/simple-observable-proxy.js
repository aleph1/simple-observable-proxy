const e=new WeakMap,t=new WeakMap,o=new WeakMap,n=[],r=e=>{e.length&&n.push(e)};export const observe=(n,s,c={})=>{let p=e.get(n)||t.has(n)&&n,a=p?t.get(p):[];if("function"!=typeof s||a.includes(s)||a.push(s),!p){const l={get(e,t){const o=e[t];return o&&"object"==typeof o?e[t]=observe(o,s,c):o},set:(e,t,o)=>(e[t]!==o&&(e[t]=o,r(a)),!0),deleteProperty:(e,t)=>t in e&&(delete e[t],r(a),!0)};c.revocable?(p=Proxy.revocable(n,l),o.set(p.proxy,p.revoke),p=p.proxy):p=new Proxy(n,l),e.set(n,p),t.set(p,a)}return p};const s=()=>{n.length&&(new Set(n.flat(1/0)).forEach((e=>{e()})),n.length=0),window.requestAnimationFrame(s)};s();export const unobserve=(o,n)=>{let r=t.get(e.get(o)||o);if(r){const e=r.indexOf(n);-1!==e&&r.splice(e,1)}};export const revoke=t=>{const n=e.get(t)||t,r=o.get(n);return!!r&&(r(),o.delete(n),!0)};